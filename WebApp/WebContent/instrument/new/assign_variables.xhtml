<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:p="http://primefaces.org/ui"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  template="/WEB-INF/templates/new_instrument.xhtml">
  <ui:define name="instrumentHead">
    <c:set var="instrumentStep" value="3" scope="request" />
    <h:outputScript name="script/datatables.min.js" />
    <h:outputStylesheet name="style/datatables.min.css" />
  </ui:define>
  <ui:define name="new_instrument_content">
    <h:form id="newInstrumentForm" method="post" charset="utf8">
      <div id="assignmentsLayout">
        <p:fieldset legend="File Columns" id="fileColumns">
          <p:tabView value="#{newInstrumentBean.instrumentFiles}" var="iFile"
            widgetVar="fileTabs">
            <p:tab>
              <f:facet name="title">
                <h:outputText id="tabTitle" value="#{iFile.fileDescription}"/>
                <p:contextMenu for="tabTitle">
                  <p:menuitem value="Rename" onclick="renameFile('#{iFile.fileDescription}')"/>
                  <p:menuitem value="Delete" onclick="removeFile('#{iFile.fileDescription}')"/>
                </p:contextMenu>
              </f:facet>
              <p:dataTable value="#{iFile.fileColumns}" var="column" scrollable="true" scrollHeight="300" tableStyleClass="fileColumnsTable">
                <p:column>
                  <f:facet name="header">
                    <h:outputText value="Column"/>
                  </f:facet>
                  <h:outputText value="#{column.name}"/>
                </p:column>
                <p:column styleClass="exampleValueCol">
                  <f:facet name="header">
                    <h:outputText value="Sample Value"/>
                  </f:facet>
                  <h:outputText styleClass="exampleValue" value="#{column.exampleValue}"/>
                </p:column>
              </p:dataTable>
            </p:tab>
          </p:tabView>
          <h:panelGrid columns="1" cellpadding="5" styleClass="buttonPanel">
            <p:commandButton value="Add File" ajax="false"
              action="#{newInstrumentBean.addFile}" immediate="true" />
          </h:panelGrid>
        </p:fieldset>
        <div id="assignInstructions">
          Drag and drop 
          <br/>
          column name &gt;&gt;
        </div>
        <p:fieldset legend="Assignments" id="assignments">
          <p:tree value="#{newInstrumentBean.assignmentsTree}" var="node" styleClass="assignmentsTree">
            <p:treeNode type="FINISHED_VARIABLE" styleClass="finishedVariable">
              <h:outputText value="#{node}"/>
            </p:treeNode>
            <p:treeNode type="UNFINISHED_VARIABLE" styleClass="unfinishedVariable">
              <h:outputText value="#{node}"/>
            </p:treeNode>
            <p:treeNode type="UNASSIGNED_SENSOR_TYPE" styleClass="unassignedSensorType">
              <h:outputText value="#{node}"/>
            </p:treeNode>
            <p:treeNode type="ASSIGNED_SENSOR_TYPE" styleClass="assignedSensorType">
              <h:outputText value="#{node}"/>
            </p:treeNode>
          </p:tree>
        </p:fieldset>
      </div>

      <!-- Remove File -->
      <h:inputHidden id="removeFileName"
        value="#{newInstrumentBean.removeFileName}" />
      <p:confirmDialog widgetVar="removeFileConfirm"
        message="Remove file and all associated assignments?">
        <p:commandButton value="Remove File" ajax="false"
          action="#{newInstrumentBean.removeFile}" />
        <p:commandButton value="Cancel"
          onclick="PF('removeFileConfirm').hide()" />
      </p:confirmDialog>
  
      <!-- Rename File -->
      <p:dialog header="Rename File" widgetVar="renameFileDialog"
        modal="true">
        
        <h:inputHidden id="renameOldFile"
          value="#{newInstrumentBean.renameOldFile}" />
        
        <p:inputText widgetVar="renameNewFile"
          value="#{newInstrumentBean.renameNewFile}" onkeyup="renameFileInputMonitor()"/>

        <h:panelGrid columns="2" cellpadding="5" styleClass="buttonPanel">
          <p:commandButton widgetVar="renameFileButton" value="Rename" ajax="false"
            action="#{newInstrumentBean.renameFile}"/>
          <p:commandButton value="Cancel"
            onclick="PF('renameFileDialog').hide(); return false;" />
        </h:panelGrid>
        
      </p:dialog>

      <!--  The cancel include has a 2 entries (1 is invisible) -->
      <h:panelGrid columns="4" cellpadding="5" styleClass="buttonPanel">
        <ui:include src="/WEB-INF/templates/new_instrument_cancel.xhtml" />
        <p:commandButton value="Back" ajax="false"
          action="#{newInstrumentBean.goToVariables}" immediate="true" />
        <p:commandButton id="nextButton" widgetVar="next" value="Next"
          ajax="false" action="#{newInstrumentBean.goToRunTypes}" />
      </h:panelGrid>
    </h:form>
  </ui:define>
</ui:composition>
