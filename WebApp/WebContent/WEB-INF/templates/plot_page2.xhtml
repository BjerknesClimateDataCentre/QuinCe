<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:p="http://primefaces.org/ui"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
  <title><ui:insert name="title">Welcome</ui:insert> - #{utils.siteName}</title>
  <h:outputScript library="primefaces" name="jquery/jquery.js" />
  <ui:insert name="localHead"></ui:insert>
  <h:outputScript name="script/jquery.splitter.js" />
  <h:outputStylesheet name="style/jquery.splitter.css" />
  <h:outputScript name="script/datatables.min.js" />
  <h:outputStylesheet name="style/datatables.min.css" />

  <!-- The script that controls all the page actions -->
  <h:outputScript name="script/plotPage2.js" />
</h:head>

<h:body class="fullPage" onload="initPage()">
  <ui:include src="/WEB-INF/templates/keep_alive.xhtml" />
  <!--  The main stylesheet goes here because it can then override PrimeFaces styles -->
  <h:outputStylesheet name="style/main.css" />
  <h:outputStylesheet name="style/plotPage2.css" />

  <!-- General form for page-level data, commands etc -->
  <h:form id="plotPageForm" method="post">
    <h:inputHidden id="error"
      value="#{sessionScope[beanName].error}" />

    <h:inputHidden id="columnHeadings"
      value="#{sessionScope[beanName].data.columnHeadingsJson}" />

    <h:inputHidden id="rowIDs"
      value="#{sessionScope[beanName].data.rowIDsJson}" />

    <p:remoteCommand name="loadData"
      action="#{sessionScope[beanName].loadData}"
      process="@this" update="error columnHeadings rowIDs"
      oncomplete="dataLoaded()" />

  </h:form>

  <!-- Form for table data -->
  <h:form id="tableForm" method="post">
    <h:inputHidden value="#{sessionScope[beanName].tableJsonData}"
      id="tableJsonData" />
    <h:inputHidden value="#{sessionScope[beanName].recordCount}"
      id="recordCount" />
    <h:inputHidden value="#{sessionScope[beanName].tableDataDraw}"
      id="tableDataDraw" />
    <h:inputHidden value="#{sessionScope[beanName].tableDataStart}"
      id="tableDataStart" />
    <h:inputHidden value="#{sessionScope[beanName].tableDataLength}"
      id="tableDataLength" />
    <p:remoteCommand name="tableGetData"
      action="#{sessionScope[beanName].generateTableData}"
      process="tableDataDraw tableDataStart tableDataLength"
      update="tableJsonData tableDataDraw recordCount"
      oncomplete="tableDataDownload()" />
  </h:form>

  <p:dialog header="Please wait" widgetVar="pleaseWait" modal="true"
    resizable="false" closable="false">
    Preparing data. This can take quite a while, so please be patient...
  </p:dialog>

  <p:dialog header="Error" widgetVar="errorMessage" modal="true"
    resizable="false" closable="false">

    <div class="error">
      ERROR: An error occurred during processing. Please report the following to site support:
    </div>

    <div id="errorMessageString" class="instructions">
      ...
    </div>
    <h:panelGrid columns="1" cellpadding="5" styleClass="buttonPanel">
      <p:commandButton id="abortButton" value="Close"
        action="#{sessionScope[beanName].abort}" />
    </h:panelGrid>
  </p:dialog>

  <p:toolbar styleClass="plotPageHeader">
    <f:facet name="left">
      #{sessionScope[beanName].dataset.name} - <ui:insert name="qcType">Quality Control</ui:insert>
    </f:facet>
    <f:facet name="right">
      <ui:insert name="pageStatus"></ui:insert>
    </f:facet>
  </p:toolbar>

  <div id="plotPageContent" class="plotPageContent">
    <div id="plots">
      <div id="plot1Panel" class="plotContainer">
        Plot 1
      </div>
      <div id="plot2Panel" class="plotContainer">
        Plot 2
      </div>
    </div>
    <div id="tableContent"></div>
  </div>

  <p:toolbar id="footerToolbar" styleClass="plotPageFooter">
    <f:facet name="left">
      <!--
      <p:selectOneMenu widgetVar="columnSelector"
        onchange="scrollToColumn(event.target.value)">
        <f:selectItems value="#{sessionScope[beanName].data.columnGroupOffsets}" />
      </p:selectOneMenu>
      -->
    </f:facet>
    <f:facet name="right">
      <div id="qcMessage" class="inline"></div>
      <div id="qcControls">
        <ui:fragment rendered="#{!sessionScope[beanName].canEdit}">
          <span class="instructions">NRT Dataset - cannot be edited</span>
        </ui:fragment>
        <ui:fragment rendered="#{sessionScope[beanName].canEdit}">
          <h:form id="selectionForm" method="post" styleClass="inline">
            Selection:
            <span id="selectedColumnDisplay"></span>
            <span id="selectedRowsCountDisplay">0</span>
            <p:commandButton icon="clearSelectionButton"
              onclick="clearSelection();" styleClass="inlineButton tightButton" />
            <h:inputHidden id="selectedColumn"
              value="#{sessionScope[beanName].data.selectedColumn}" />
            <h:inputHidden id="selectedRows"
              value="#{sessionScope[beanName].data.selectedRows}" />

            <ui:insert name="selectionFormEntries" />
            <ui:insert name="selectionDialog" />
            <ui:insert name="selectionActions">Selection actions here</ui:insert>
          </h:form>
        </ui:fragment>
        |
        <h:form id="finishButtonForm" method="post" styleClass="inline">
         <p:commandButton widgetVar="finishButton" value="Finish" ajax="false"
           process="@none" action="#{sessionScope[beanName].finish}" styleClass="inlineButton" />
        </h:form>
      </div>
    </f:facet>
  </p:toolbar>
</h:body>
</html>
